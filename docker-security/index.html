<!DOCTYPE html>
<html lang="tr" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Docker Container Güvenliği | Ahmet Buğra</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="noise-overlay"></div>
    
    <header class="header">
        <div class="container">
            <a href="/" class="logo">
                <span class="logo-bracket">[</span>
                <span class="logo-text">ahmetbugra</span>
                <span class="logo-bracket">]</span>
            </a>
            <nav class="nav">
                <a href="/" class="nav-link">Blog</a>
                <a href="/#about" class="nav-link">Hakkımda</a>
                <a href="https://github.com/ahmetbugra" class="nav-link" target="_blank">GitHub</a>
                <button class="theme-toggle" id="themeToggle" aria-label="Tema Değiştir">
                    <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                    <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </button>
            </nav>
            <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Menü">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <nav class="mobile-nav" id="mobileNav">
        <a href="/" class="nav-link">Blog</a>
        <a href="/#about" class="nav-link">Hakkımda</a>
        <a href="https://github.com/ahmetbugra" class="nav-link" target="_blank">GitHub</a>
    </nav>

    <main class="main">
        <article>
            <header class="post-header">
                <div class="container">
                    <a href="/" class="back-link">
                        <span class="arrow">←</span> Tüm yazılar
                    </a>
                    <div class="post-header-meta">
                        <time datetime="2024-11-10">10 Kasım 2024</time>
                        <span class="post-header-category">DevSecOps</span>
                    </div>
                    <h1 class="post-header-title">Docker Container Güvenliği</h1>
                    <p class="post-header-excerpt">
                        Container güvenliği en iyi pratikleri, image scanning, runtime security ve Kubernetes güvenlik konfigürasyonları.
                    </p>
                </div>
            </header>

            <div class="post-content">
                <div class="container">
                    <h2>Container Güvenliğinin Önemi</h2>
                    <p>
                        Container'lar modern uygulama dağıtımının temelini oluşturur. Ancak yanlış yapılandırılmış container'lar ciddi güvenlik riskleri oluşturabilir. Bu yazıda Docker ve Kubernetes ortamlarında güvenlik en iyi pratiklerini inceleyeceğiz.
                    </p>

                    <h2>Docker Image Güvenliği</h2>

                    <h3>1. Minimal Base Image Kullanımı</h3>
                    <p>
                        Saldırı yüzeyini azaltmak için minimal base image'lar tercih edilmelidir:
                    </p>

                    <pre><code># ❌ Kötü - Gereksiz paketler içerir
FROM ubuntu:latest

# ✅ İyi - Minimal image
FROM alpine:3.18

# ✅ Daha iyi - Distroless
FROM gcr.io/distroless/static-debian11</code></pre>

                    <h3>2. Non-Root User</h3>
                    <p>
                        Container'lar asla root olarak çalıştırılmamalıdır:
                    </p>

                    <pre><code>FROM node:18-alpine

# Kullanıcı oluştur
RUN addgroup -g 1001 -S appgroup && \
    adduser -u 1001 -S appuser -G appgroup

# Uygulama dosyalarını kopyala
COPY --chown=appuser:appgroup . /app

# Non-root kullanıcıya geç
USER appuser

WORKDIR /app
CMD ["node", "server.js"]</code></pre>

                    <h3>3. Multi-Stage Builds</h3>
                    <p>
                        Build araçlarını production image'dan ayırmak:
                    </p>

                    <pre><code># Build stage
FROM golang:1.21-alpine AS builder
WORKDIR /app
COPY . .
RUN CGO_ENABLED=0 go build -o main .

# Production stage
FROM scratch
COPY --from=builder /app/main /main
USER 1001
ENTRYPOINT ["/main"]</code></pre>

                    <h2>Image Scanning</h2>

                    <h3>Trivy ile Zafiyet Tarama</h3>
                    <pre><code># Image tarama
trivy image myapp:latest

# Sadece kritik ve yüksek zafiyetler
trivy image --severity CRITICAL,HIGH myapp:latest

# CI/CD için exit code
trivy image --exit-code 1 --severity CRITICAL myapp:latest

# SBOM oluşturma
trivy image --format spdx-json -o sbom.json myapp:latest</code></pre>

                    <h3>Snyk ile Tarama</h3>
                    <pre><code># Container tarama
snyk container test myapp:latest

# Dockerfile tarama
snyk iac test Dockerfile</code></pre>

                    <h2>Runtime Security</h2>

                    <h3>Security Options</h3>
                    <pre><code># Güvenli container çalıştırma
docker run \
  --read-only \
  --no-new-privileges \
  --security-opt="no-new-privileges:true" \
  --cap-drop=ALL \
  --cap-add=NET_BIND_SERVICE \
  --user 1001:1001 \
  myapp:latest</code></pre>

                    <h3>Seccomp Profilleri</h3>
                    <pre><code>{
  "defaultAction": "SCMP_ACT_ERRNO",
  "architectures": ["SCMP_ARCH_X86_64"],
  "syscalls": [
    {
      "names": ["read", "write", "exit", "exit_group"],
      "action": "SCMP_ACT_ALLOW"
    }
  ]
}</code></pre>

                    <pre><code># Seccomp profili ile çalıştırma
docker run --security-opt seccomp=profile.json myapp:latest</code></pre>

                    <h2>Kubernetes Güvenliği</h2>

                    <h3>Pod Security Standards</h3>
                    <pre><code>apiVersion: v1
kind: Pod
metadata:
  name: secure-pod
spec:
  securityContext:
    runAsNonRoot: true
    runAsUser: 1001
    fsGroup: 1001
    seccompProfile:
      type: RuntimeDefault
  containers:
  - name: app
    image: myapp:latest
    securityContext:
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: true
      capabilities:
        drop:
          - ALL
    resources:
      limits:
        memory: "128Mi"
        cpu: "500m"
      requests:
        memory: "64Mi"
        cpu: "250m"</code></pre>

                    <h3>Network Policies</h3>
                    <pre><code>apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: deny-all
  namespace: production
spec:
  podSelector: {}
  policyTypes:
  - Ingress
  - Egress

---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-web
  namespace: production
spec:
  podSelector:
    matchLabels:
      app: web
  policyTypes:
  - Ingress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: ingress
    ports:
    - protocol: TCP
      port: 8080</code></pre>

                    <h3>RBAC Konfigürasyonu</h3>
                    <pre><code>apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: pod-reader
  namespace: default
rules:
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "list", "watch"]

---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: read-pods
  namespace: default
subjects:
- kind: ServiceAccount
  name: monitoring
  namespace: default
roleRef:
  kind: Role
  name: pod-reader
  apiGroup: rbac.authorization.k8s.io</code></pre>

                    <h2>CI/CD Pipeline Güvenliği</h2>

                    <pre><code># GitHub Actions örneği
name: Container Security

on: [push]

jobs:
  security-scan:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Build Image
      run: docker build -t myapp:${{ github.sha }} .
    
    - name: Run Trivy
      uses: aquasecurity/trivy-action@master
      with:
        image-ref: 'myapp:${{ github.sha }}'
        exit-code: '1'
        severity: 'CRITICAL,HIGH'
    
    - name: Run Hadolint
      uses: hadolint/hadolint-action@v3.1.0
      with:
        dockerfile: Dockerfile</code></pre>

                    <h2>Monitoring ve Alerting</h2>
                    <ul>
                        <li><strong>Falco:</strong> Runtime threat detection</li>
                        <li><strong>Sysdig:</strong> Container visibility</li>
                        <li><strong>Aqua Security:</strong> Full lifecycle security</li>
                        <li><strong>Twistlock (Prisma Cloud):</strong> Comprehensive protection</li>
                    </ul>

                    <h3>Falco Kuralları</h3>
                    <pre><code>- rule: Shell in Container
  desc: Detect shell execution in container
  condition: >
    spawned_process and 
    container and
    proc.name in (bash, sh, zsh)
  output: >
    Shell spawned in container 
    (user=%user.name container=%container.name)
  priority: WARNING</code></pre>

                    <blockquote>
                        <p>
                            Container güvenliği, build aşamasından runtime'a kadar her adımda düşünülmelidir. Defense in depth prensibiyle çok katmanlı güvenlik sağlayın.
                        </p>
                    </blockquote>
                </div>
            </div>
        </article>
    </main>

    <footer class="footer">
        <div class="container">
            <p class="footer-text">
                <span class="footer-year">© 2024</span> 
                <span class="footer-separator">|</span>
                <span>Ahmet Buğra</span>
                <span class="footer-separator">|</span>
                <span class="footer-made">Made with <span class="heart">♥</span> and caffeine</span>
            </p>
        </div>
    </footer>

    <script src="../script.js"></script>
</body>
</html>

